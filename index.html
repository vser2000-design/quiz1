<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Play and be smarter">
    <meta name="theme-color" content="#6366F1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="My Quiz">
    
    <title>Play and be smarter</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        * {
            -webkit-tap-highlight-color: transparent;
        }
        @media (max-width: 640px) {
            .mobile-btn {
                font-size: 0.875rem !important;
                padding: 0.5rem 0.75rem !important;
            }
            .mobile-question {
                font-size: 1.5rem !important;
                padding: 1rem !important;
            }
            .mobile-option {
                font-size: 1rem !important;
                padding: 0.875rem !important;
            }
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // --- 1. ГЛОБАЛЬНЫЕ НАСТРОЙКИ СЛОВАРЕЙ ---
        const DICTIONARY_CONFIG = {
            'food_br': { 
                name: 'food_br', 
                url: 'https://raw.githubusercontent.com/vser2000-design/quiz1/main/food_br.json' 
            },
            'slang_br': { 
                name: 'slang_br', 
                url: 'https://raw.githubusercontent.com/vser2000-design/quiz1/main/slang_br.json' 
         },
            'slang_nl': { 
                name: 'slang_nl', 
                url: 'https://raw.githubusercontent.com/vser2000-design/quiz1/main/slang_nl.json' 
            }
        };

        let currentVocabulary = [];
        let selectedDictionaryKey = Object.keys(DICTIONARY_CONFIG)[0];
        
        // Асинхронная функция загрузки словаря
        async function loadDictionary(key) {
            const url = DICTIONARY_CONFIG[key].url;
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Ошибка загрузки: ${response.status} ${response.statusText}`);
                }
                currentVocabulary = await response.json();
                return true;
            } catch (error) {
                console.error("Не удалось загрузить словарь:", error);
                alert(`Ошибка загрузки словаря "${DICTIONARY_CONFIG[key].name}". Проверьте URL.`);
                return false;
            }
        }
        
        let gameState = 'menu';
        let currentQuestion = null;
        let options = [];
        let selectedAnswer = null;
        let correctAnswer = null;
        let score = { correct: 0, total: 0 };
        let usedIndices = [];

        function updateSelectedDictionary(key) {
            selectedDictionaryKey = key;
        }

        async function initGame() {
            const playButton = document.querySelector('button[onclick="initGame()"]');
            if (playButton) {
                playButton.textContent = 'Загрузка...';
                playButton.disabled = true;
                playButton.classList.add('opacity-50', 'cursor-not-allowed');
            }
            
            const success = await loadDictionary(selectedDictionaryKey);
            
            if (success && currentVocabulary.length > 0) {
                startGame();
            } else {
                if (playButton) {
                    playButton.textContent = '▶ Play';
                    playButton.disabled = false;
                    playButton.classList.remove('opacity-50', 'cursor-not-allowed');
                }
                if (currentVocabulary.length === 0) {
                    alert('Загруженный словарь пуст. Проверьте содержимое JSON-файла.');
                }
            }
        }

        function render() {
            const app = document.getElementById('app');
            
            if (gameState === 'menu') {
                const optionsHTML = Object.entries(DICTIONARY_CONFIG).map(([key, dict]) => `
                    <option value="${key}" ${key === selectedDictionaryKey ? 'selected' : ''}>${dict.name}</option>
                `).join('');

                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-green-400 via-blue-500 to-purple-600 flex items-center justify-center p-4">
                        <div class="bg-white rounded-3xl shadow-2xl p-6 sm:p-8 max-w-md w-full">
                            <div class="text-center mb-6 sm:mb-8">
                                <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2 sm:mb-3">Language Learner</h1>
                                <p class="text-lg sm:text-xl text-gray-600">Choose a dictionary and start the game!</p>
                            </div>
                            
                            <div class="mb-4 sm:mb-6">
                                <label for="dictionary-selector" class="block text-gray-700 font-semibold mb-2">Choose a dictionary:</label>
                                <select id="dictionary-selector" onchange="updateSelectedDictionary(this.value)"
                                    class="w-full p-2.5 sm:p-3 border-2 border-gray-300 rounded-xl bg-white text-base sm:text-lg focus:border-blue-500 focus:ring-blue-500 transition-all">
                                    ${optionsHTML}
                                </select>
                            </div>
                            <button onclick="initGame()" class="w-full bg-gradient-to-r from-green-500 to-blue-600 text-white py-4 sm:py-5 px-6 rounded-2xl font-bold text-xl sm:text-2xl hover:from-green-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg">
                                ▶ Play
                            </button>
                        </div>
                    </div>
                `;

            } else if (gameState === 'playing') {
                const totalWords = currentVocabulary.length;
                const questionNumber = usedIndices.length;
                const showResult = selectedAnswer !== null;

                let topBarContent;
                
                if (showResult) {
                    const isCorrect = selectedAnswer === correctAnswer;
                    const resultText = isCorrect ? 'Yes! ✓' : 'No! ✗';
                    const resultClass = isCorrect ? 'bg-green-500 hover:bg-green-600' : 'bg-red-500 hover:bg-red-600';
                    const finishDisabled = questionNumber >= totalWords ? 'disabled' : '';

                    topBarContent = `
                        <button onclick="nextQuestion()" class="mobile-btn flex-1 py-2 px-4 rounded-lg font-bold text-base text-white transition-all shadow-md ${resultClass}" ${finishDisabled}>
                            ${resultText} →
                        </button>
                        <button onclick="finishGame()" class="mobile-btn px-3 py-2 bg-yellow-500 text-white rounded-lg font-semibold hover:bg-yellow-600 transition-all shadow-md text-sm">
                            Finish
                        </button>
                        <button onclick="exitGame()" class="mobile-btn px-3 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition-all shadow-md text-sm whitespace-nowrap">
                            Menu
                        </button>
                    `;
                } else {
                    topBarContent = `
                        <div class="flex-1 text-center text-base sm:text-lg font-semibold text-gray-700">
                            ${questionNumber} / ${totalWords}
                        </div>
                        <button onclick="finishGame()" class="mobile-btn px-3 py-2 bg-yellow-500 text-white rounded-lg font-semibold hover:bg-yellow-600 transition-all shadow-md text-sm">
                            Finish
                        </button>
                        <button onclick="exitGame()" class="mobile-btn px-3 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition-all shadow-md text-sm whitespace-nowrap">
                            Menu
                        </button>
                    `;
                }
                
                let optionsHTML = options.map((option, index) => {
                    const isSelected = selectedAnswer === option;
                    const isCorrect = option === correctAnswer;
                    
                    let buttonClass = 'mobile-option w-full p-4 rounded-xl font-semibold text-base sm:text-lg transition-all border-2 ';
                    if (showResult) {
                        if (isCorrect) {
                            buttonClass += 'bg-green-500 text-white border-green-600';
                        } else if (isSelected && !isCorrect) {
                            buttonClass += 'bg-red-500 text-white border-red-600';
                        } else {
                            buttonClass += 'bg-gray-200 text-gray-500 border-gray-300';
                        }
                    } else {
                        buttonClass += 'bg-white text-gray-800 border-gray-300 hover:border-blue-500 hover:bg-blue-50';
                    }
                    
                    return `<button onclick="selectAnswer('${option.replace(/'/g, "\\'")}')" ${showResult ? 'disabled' : ''} class="${buttonClass}">${option}</button>`;
                }).join('');
                
                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-green-400 via-blue-500 to-purple-600 p-3 sm:p-4">
                        <div class="max-w-3xl mx-auto">
                            <div class="bg-white/95 backdrop-blur rounded-xl shadow-xl p-2.5 sm:p-3 mb-3 sm:mb-4">
                                <div class="flex items-center gap-2 justify-between">
                                    ${topBarContent}
                                </div>
                            </div>
                            <div class="bg-white rounded-2xl sm:rounded-3xl shadow-2xl p-4 sm:p-6">
                                <div class="mobile-question mb-6 p-6 bg-gradient-to-r from-purple-100 to-blue-100 rounded-xl sm:rounded-2xl">
                                    <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 text-center break-words">${currentQuestion}</h2>
                                </div>
                                <div class="grid grid-cols-1 gap-3 sm:gap-4">
                                    ${optionsHTML}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (gameState === 'finished') {
                const percentage = score.total === 0 ? 0 : Math.round((score.correct / score.total) * 100);
                let motivation = '';
                if (percentage >= 80) motivation = '<p class="text-2xl sm:text-3xl text-green-600 font-bold mb-6 sm:mb-8">Great job!</p>';
                else if (percentage >= 50) motivation = '<p class="text-2xl sm:text-3xl text-blue-600 font-bold mb-6 sm:mb-8">Not so bad</p>';
                else motivation = '<p class="text-2xl sm:text-3xl text-orange-600 font-bold mb-6 sm:mb-8">Dont be sad, be cool :)</p>';

                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-green-400 via-blue-500 to-purple-600 flex items-center justify-center p-4">
                        <div class="bg-white rounded-3xl shadow-2xl p-6 sm:p-8 max-w-lg w-full">
                            <div class="text-center mb-6 sm:mb-8">
                                <h1 class="text-3xl sm:text-5xl font-bold text-gray-800 mb-4 sm:mb-6">End Game</h1>
                                <div class="mb-6 sm:mb-8 p-6 sm:p-8 bg-gradient-to-r from-purple-100 to-blue-100 rounded-2xl">
                                    <p class="text-5xl sm:text-7xl font-bold text-gray-800 mb-2 sm:mb-3">${percentage}%</p>
                                    <p class="text-2xl sm:text-3xl text-gray-700 font-semibold">${score.correct} из ${score.total}</p>
                                </div>
                                ${motivation}
                            </div>
                            <div class="flex flex-col sm:flex-row gap-3 sm:gap-4">
                                <button onclick="exitGame(true)" class="flex-1 bg-gradient-to-r from-green-500 to-blue-600 text-white py-4 sm:py-5 px-6 rounded-xl font-bold text-base sm:text-lg hover:from-green-600 hover:to-blue-700 transition-all shadow-lg">
                                    Play again
                                </button>
                                <button onclick="exitGame()" class="flex-1 bg-gray-500 text-white py-4 sm:py-5 px-6 rounded-xl font-bold text-base sm:text-lg hover:bg-gray-600 transition-all shadow-lg">
                                    Menu
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function startGame() {
            gameState = 'playing';
            score = { correct: 0, total: 0 };
            usedIndices = [];
            generateQuestion();
        }

        function generateQuestion() {
            if (usedIndices.length >= currentVocabulary.length) {
                finishGame();
                return;
            }

            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * currentVocabulary.length);
            } while (usedIndices.includes(randomIndex));

            const question = currentVocabulary[randomIndex];
            correctAnswer = question.a;
            currentQuestion = question.q;

            const wrongAnswers = [];
            while (wrongAnswers.length < 2) { 
                const randomWrongIndex = Math.floor(Math.random() * currentVocabulary.length);
                const wrongAns = currentVocabulary[randomWrongIndex].a;
                if (wrongAns !== correctAnswer && !wrongAnswers.includes(wrongAns)) {
                    wrongAnswers.push(wrongAns);
                }
            }

            options = [...wrongAnswers, correctAnswer].sort(() => Math.random() - 0.5);
            selectedAnswer = null;
            usedIndices.push(randomIndex);
            render();
        }

        function selectAnswer(answer) {
            if (selectedAnswer !== null) return;
            selectedAnswer = answer;
            const isCorrect = answer === correctAnswer;
            score.correct += isCorrect ? 1 : 0;
            score.total += 1;
            render();
        }

        function nextQuestion() {
            generateQuestion();
        }

        function finishGame() {
            gameState = 'finished';
            render();
        }

        function exitGame(restart = false) {
            score = { correct: 0, total: 0 };
            usedIndices = [];
            if (restart) {
                startGame();
            } else {
                gameState = 'menu';
                render();
            }
        }

        loadDictionary(selectedDictionaryKey).then(() => render());
    </script>
</body>
</html>