<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Play and be smarter">
    <meta name="theme-color" content="#6366F1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="My Quiz">
    
    <title>Language Learning Game - –ò–∑—É—á–∞–π —è–∑—ã–∫–∏</title>
    
    <link rel="manifest" href="/quiz1/manifest.json">
    
    <link rel="icon" type="image/png" sizes="192x192" href="/quiz1/icon-192.png">
    <link rel="apple-touch-icon" href="/quiz1/icon-192.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        * {
            -webkit-tap-highlight-color: transparent;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/quiz1/sw.js')
                    .then(reg => console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω'))
                    .catch(err => console.log('–û—à–∏–±–∫–∞ Service Worker:', err));
            });
        }

        // --- 1. –ù–û–í–´–ï –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò –°–õ–û–í–ê–†–ï–ô ---
        const DICTIONARY_CONFIG = {
            'food': { 
                name: 'food', 
                // !!! –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–û–¢ URL –ù–ê –†–ï–ê–õ–¨–ù–£–Æ RAW –°–°–´–õ–ö–£ GITHUB !!!
                url: 'https://raw.githubusercontent.com/vser2000-design/quiz1/main/food_x.json' 
            },
            'travel': { 
                name: 'travel', 
                // !!! –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–û–¢ URL –ù–ê –†–ï–ê–õ–¨–ù–£–Æ RAW –°–°–´–õ–ö–£ GITHUB !!!
                url: 'https://raw.githubusercontent.com/vser2000-design/quiz1/main/travel_x.json' 
            },
            'phrasal': { 
                name: 'phrasal', 
                // !!! –ó–ê–ú–ï–ù–ò–¢–ï –≠–¢–û–¢ URL –ù–ê –†–ï–ê–õ–¨–ù–£–Æ RAW –°–°–´–õ–ö–£ GITHUB !!!
                url: 'https://raw.githubusercontent.com/vser2000-design/quiz1/main/phrasal-verbs_x.json' 
            }
        };

        let currentVocabulary = [];
        let selectedDictionaryKey = Object.keys(DICTIONARY_CONFIG)[0];
        
        // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–æ–≤–∞—Ä—è
        async function loadDictionary(key) {
            const url = DICTIONARY_CONFIG[key].url;
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${response.status} ${response.statusText}`);
                }
                currentVocabulary = await response.json();
                return true;
            } catch (error) {
                console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ª–æ–≤–∞—Ä—å:", error);
                alert(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–æ–≤–∞—Ä—è "${DICTIONARY_CONFIG[key].name}". –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL.`);
                return false;
            }
        }
        // --- –ö–û–ù–ï–¶ –ù–û–í–´–• –ì–õ–û–ë–ê–õ–¨–ù–´–• –ù–ê–°–¢–†–û–ï–ö ---
        
        // –í–µ—Å—å –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let gameState = 'menu';
        let currentQuestion = null;
        let options = [];
        let selectedAnswer = null;
        let correctAnswer = null;
        let score = { correct: 0, total: 0 };
        let usedIndices = [];

        function updateSelectedDictionary(key) {
            selectedDictionaryKey = key;
        }

        async function initGame() {
            const playButton = document.querySelector('button[onclick="initGame()"]');
            if (playButton) {
                playButton.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
                playButton.disabled = true;
                playButton.classList.add('opacity-50', 'cursor-not-allowed');
            }
            
            const success = await loadDictionary(selectedDictionaryKey);
            
            if (success && currentVocabulary.length > 0) {
                startGame();
            } else {
                if (playButton) {
                    playButton.textContent = '‚ñ∂ Play';
                    playButton.disabled = false;
                    playButton.classList.remove('opacity-50', 'cursor-not-allowed');
                }
                if (currentVocabulary.length === 0) {
                    alert('–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å –ø—É—Å—Ç. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ JSON-—Ñ–∞–π–ª–∞.');
                }
            }
        }


        function render() {
            const app = document.getElementById('app');
            
            if (gameState === 'menu') {
                // –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–π –∫–æ–¥ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ —Å–ª–æ–≤–∞—Ä–µ–π
                const optionsHTML = Object.entries(DICTIONARY_CONFIG).map(([key, dict]) => `
                    <option value="${key}" ${key === selectedDictionaryKey ? 'selected' : ''}>${dict.name}</option>
                `).join('');

                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-green-400 via-blue-500 to-purple-600 flex items-center justify-center p-4">
                        <div class="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full">
                            <div class="text-center mb-8">
                                <h1 class="text-5xl font-bold text-gray-800 mb-3">Language Learner</h1>
                                <p class="text-xl text-gray-600">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≤–∞—Ä—å –∏ –Ω–∞—á–Ω–∏—Ç–µ –∏–≥—Ä—É!</p>
                            </div>
                            
                            <div class="mb-6">
                                <label for="dictionary-selector" class="block text-gray-700 font-semibold mb-2">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–≤–∞—Ä—å:</label>
                                <select id="dictionary-selector" onchange="updateSelectedDictionary(this.value)"
                                    class="w-full p-3 border-2 border-gray-300 rounded-xl bg-white text-lg focus:border-blue-500 focus:ring-blue-500 transition-all">
                                    ${optionsHTML}
                                </select>
                            </div>
                            <button onclick="initGame()" class="w-full bg-gradient-to-r from-green-500 to-blue-600 text-white py-5 px-6 rounded-2xl font-bold text-2xl hover:from-green-600 hover:to-blue-700 transition-all transform hover:scale-105 shadow-lg">
                                ‚ñ∂ Play
                            </button>
                        </div>
                    </div>
                `;

            } else if (gameState === 'playing') {
                const totalWords = currentVocabulary.length; // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–∏–π —Å–ª–æ–≤–∞—Ä—å
                const percentage = score.total === 0 ? 0 : Math.round((score.correct / score.total) * 100);
                const showNext = selectedAnswer !== null;
                
                let optionsHTML = options.map((option, index) => {
                    const isSelected = selectedAnswer === option;
                    const isCorrect = option === correctAnswer;
                    const showResult = selectedAnswer !== null;
                    
                    let buttonClass = 'w-full p-5 rounded-xl font-semibold text-lg transition-all border-2 ';
                    if (showResult) {
                        if (isCorrect) {
                            buttonClass += 'bg-green-500 text-white border-green-600';
                        } else if (isSelected && !isCorrect) {
                            buttonClass += 'bg-red-500 text-white border-red-600';
                        } else {
                            buttonClass += 'bg-gray-200 text-gray-500 border-gray-300';
                        }
                    } else {
                        buttonClass += 'bg-white text-gray-800 border-gray-300 hover:border-blue-500 hover:bg-blue-50';
                    }
                    
                    return `<button onclick="selectAnswer('${option.replace(/'/g, "\\'")}')" ${showResult ? 'disabled' : ''} class="${buttonClass}">${option}</button>`;
                }).join('');
                
                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-green-400 via-blue-500 to-purple-600 p-4">
                        <div class="max-w-3xl mx-auto">
                            <div class="bg-white/95 backdrop-blur rounded-2xl shadow-xl p-4 mb-6">
                                <div class="flex items-center justify-between flex-wrap gap-3">
                                    <div class="flex items-center gap-4">
                                        <div class="text-2xl font-bold text-gray-800">${score.correct}/${score.total}</div>
                                        <div class="text-xl font-semibold text-blue-600">${percentage}%</div>
                                        <div class="text-sm text-gray-500">–í–æ–ø—Ä–æ—Å ${usedIndices.length} –∏–∑ ${totalWords}</div>
                                    </div>
                                    <div class="flex gap-2">
                                        ${showNext && usedIndices.length < totalWords ? '<button onclick="nextQuestion()" class="px-5 py-2.5 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl font-semibold hover:from-blue-600 hover:to-purple-700 transition-all shadow-md">Next ‚Üí</button>' : ''}
                                        <button onclick="finishGame()" class="px-5 py-2.5 bg-yellow-500 text-white rounded-xl font-semibold hover:bg-yellow-600 transition-all shadow-md">Finish</button>
                                        <button onclick="exitGame()" class="px-5 py-2.5 bg-red-500 text-white rounded-xl font-semibold hover:bg-red-600 transition-all shadow-md">‚úï Exit</button>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white rounded-3xl shadow-2xl p-8">
                                <div class="mb-8 p-8 bg-gradient-to-r from-purple-100 to-blue-100 rounded-2xl">
                                    <h2 class="text-4xl font-bold text-gray-800 text-center break-words">${currentQuestion}</h2>
                                </div>
                                <div class="grid grid-cols-1 gap-4 mb-6">
                                    ${optionsHTML}
                                </div>
                                ${selectedAnswer ? `
                                    <div class="text-center">
                                        <div class="p-6 ${selectedAnswer === correctAnswer ? 'bg-green-100 border-green-500' : 'bg-red-100 border-red-500'} rounded-2xl border-2">
                                            <p class="text-4xl font-bold ${selectedAnswer === correctAnswer ? 'text-green-700' : 'text-red-700'}">
                                                ${selectedAnswer === correctAnswer ? 'Yes! ‚úì' : 'No! ‚úó'}
                                            </p>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            } else if (gameState === 'finished') {
                // –ö–æ–¥ –¥–ª—è 'finished' –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∫—Ä–æ–º–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è currentVocabulary.length
                const percentage = score.total === 0 ? 0 : Math.round((score.correct / score.total) * 100);
                let motivation = '';
                if (percentage >= 80) motivation = '<p class="text-3xl text-green-600 font-bold mb-8">–û—Ç–ª–∏—á–Ω–æ! üéâ</p>';
                else if (percentage >= 50) motivation = '<p class="text-3xl text-blue-600 font-bold mb-8">–•–æ—Ä–æ—à–æ! üëç</p>';
                else motivation = '<p class="text-3xl text-orange-600 font-bold mb-8">–ü—Ä–æ–¥–æ–ª–∂–∞–π –ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞—Ç—å—Å—è! üí™</p>';
                
                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-green-400 via-blue-500 to-purple-600 flex items-center justify-center p-4">
                        <div class="bg-white rounded-3xl shadow-2xl p-8 max-w-lg w-full">
                            <div class="text-center mb-8">
                                <h1 class="text-5xl font-bold text-gray-800 mb-6">üéâ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h1>
                                <div class="mb-8 p-8 bg-gradient-to-r from-purple-100 to-blue-100 rounded-2xl">
                                    <p class="text-7xl font-bold text-gray-800 mb-3">${percentage}%</p>
                                    <p class="text-3xl text-gray-700 font-semibold">${score.correct} –∏–∑ ${score.total}</p>
                                </div>
                                ${motivation}
                            </div>
                            <div class="flex gap-4">
                                <button onclick="exitGame(true)" class="flex-1 bg-gradient-to-r from-green-500 to-blue-600 text-white py-5 px-6 rounded-xl font-bold text-lg hover:from-green-600 hover:to-blue-700 transition-all shadow-lg">
                                    –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞
                                </button>
                                <button onclick="exitGame()" class="flex-1 bg-gray-500 text-white py-5 px-6 rounded-xl font-bold text-lg hover:bg-gray-600 transition-all shadow-lg">
                                    –í –º–µ–Ω—é
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function startGame() {
            gameState = 'playing';
            score = { correct: 0, total: 0 };
            usedIndices = [];
            generateQuestion();
        }

        function generateQuestion() {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º currentVocabulary.length
            if (usedIndices.length >= currentVocabulary.length) {
                finishGame();
                return;
            }

            let randomIndex;
            do {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º currentVocabulary.length
                randomIndex = Math.floor(Math.random() * currentVocabulary.length);
            } while (usedIndices.includes(randomIndex));

            const question = currentVocabulary[randomIndex]; // –ò—Å–ø–æ–ª—å–∑—É–µ–º currentVocabulary
            correctAnswer = question.a;
            currentQuestion = question.q;

            // --- –ò–ó–ú–ï–ù–ï–ù–ò–ï: –£–º–µ–Ω—å—à–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞ –¥–æ 3 (2 –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö + 1 –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π) ---
            const wrongAnswers = [];
            while (wrongAnswers.length < 2) { 
                const randomWrongIndex = Math.floor(Math.random() * currentVocabulary.length);
                const wrongAns = currentVocabulary[randomWrongIndex].a; // –ò—Å–ø–æ–ª—å–∑—É–µ–º currentVocabulary
                if (wrongAns !== correctAnswer && !wrongAnswers.includes(wrongAns)) {
                    wrongAnswers.push(wrongAns);
                }
            }
            // --- –ö–û–ù–ï–¶ –ò–ó–ú–ï–ù–ï–ù–ò–Ø ---

            options = [...wrongAnswers, correctAnswer].sort(() => Math.random() - 0.5);
            selectedAnswer = null;
            usedIndices.push(randomIndex);
            render();
        }

        function selectAnswer(answer) {
            if (selectedAnswer !== null) return;
            selectedAnswer = answer;
            const isCorrect = answer === correctAnswer;
            score.correct += isCorrect ? 1 : 0;
            score.total += 1;
            render();
        }

        function nextQuestion() {
            generateQuestion();
        }

        function finishGame() {
            gameState = 'finished';
            render();
        }

        // –ò–∑–º–µ–Ω–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
        function exitGame(restart = false) {
            score = { correct: 0, total: 0 };
            usedIndices = [];
            if (restart) {
                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª "–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞" –Ω–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º —ç–∫—Ä–∞–Ω–µ
                startGame();
            } else {
                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª "Exit" –∏–ª–∏ "–í –º–µ–Ω—é"
                gameState = 'menu';
                render();
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ª–æ–≤–∞—Ä—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —á—Ç–æ–±—ã —Å—Ä–∞–∑—É –∑–Ω–∞—Ç—å –µ–≥–æ —Ä–∞–∑–º–µ—Ä –≤ –º–µ–Ω—é
        loadDictionary(selectedDictionaryKey).then(() => render());

    </script>
</body>

</html>

